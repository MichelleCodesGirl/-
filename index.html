<!DOCTYPE html>
<html>
<head>
    <title>Grapple-Bot: Arcade Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #05050a; font-family: 'Courier New', monospace; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; color: #fff; pointer-events: none; z-index: 10; display: none; }
        .stat { background: rgba(0, 0, 0, 0.8); padding: 10px; border: 1px solid #00fff2; margin-bottom: 5px; box-shadow: 0 0 10px #00fff2; }
        
        /* Screens */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; text-align: center; z-index: 100;
        }
        #start-screen { background: radial-gradient(circle, #0a1a2f 0%, #05050a 100%); color: #00fff2; }
        #game-over-screen { background: rgba(20, 0, 0, 0.9); color: #ff0055; display: none; }
        
        button { 
            padding: 15px 30px; font-size: 20px; background: none; border: 2px solid currentColor; 
            color: inherit; cursor: pointer; font-family: inherit; margin-top: 20px;
            transition: 0.2s;
        }
        button:hover { background: rgba(255,255,255,0.1); transform: scale(1.1); }
        h1 { font-size: 60px; margin: 0; text-shadow: 0 0 20px currentColor; }
    </style>
</head>
<body>

<div id="start-screen" class="overlay">
    <h1>GRAPPLE-BOT</h1>
    <p>SIX WORLDS. ONE ROBOT.</p>
    <button onclick="initGame('start')">START MISSION</button>
</div>

<div id="game-over-screen" class="overlay">
    <h1>CRITICAL FAILURE</h1>
    <p>SECTOR REACHED: <span id="final-lvl">0</span></p>
    <button onclick="initGame('reset')">REBOOT SYSTEM</button>
</div>

<div id="ui">
    <div class="stat">SECTOR: <span id="lvl-display">1</span></div>
    <div class="stat">FAILURES: <span id="deaths">0</span></div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let deaths = 0, currentLevel = 1, sawAngle = 0, cameraX = 0, trail = [], gameActive = false;

const THEMES = {
    neon: { bg: '#05050a', plat: '#111122', hazard: '#ff0055', accent: '#00fff2', name: 'NEON CITY' },
    jungle: { bg: '#0a1a0a', plat: '#2d4a22', hazard: '#ffcc00', accent: '#7cfc00', name: 'JUNGLE' },
    volcano: { bg: '#1a0505', plat: '#4a1111', hazard: '#ff4500', accent: '#ffda00', name: 'VOLCANO' },
    xmas: { bg: '#0b1d36', plat: '#ffffff', hazard: '#2e7d32', accent: '#ff0000', name: 'NORTH POLE' },
    ice: { bg: '#e0f7fa', plat: '#b2ebf2', hazard: '#006064', accent: '#00bcd4', name: 'ARCTIC TUNDRA' },
    donut: { bg: '#ffc0cb', plat: '#6f4e37', hazard: '#ff1493', accent: '#ffffff', name: 'DONUT WORLD' }
};

let currentTheme = THEMES.neon;
const player = { x: 100, y: 300, w: 30, h: 30, vx: 0, vy: 0, speed: 0.6, drag: 0.98, gravity: 0.45, grapplePoint: null, isGrappling: false, length: 0 };
let platforms = [], saws = [], goal = { x: 3000 };

// --- Chiptune Music ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playBeat() {
    if(!gameActive) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(110 + (currentLevel * 5), audioCtx.currentTime);
    gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.4);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + 0.4);
    setTimeout(playBeat, 600);
}

function initGame(type) {
    if(type === 'reset') {
        deaths = 0; currentLevel = 1;
        document.getElementById('deaths').innerText = "0";
    }
    gameActive = true;
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('game-over-screen').style.display = 'none';
    document.getElementById('ui').style.display = 'block';
    audioCtx.resume();
    playBeat();
    buildLevel(currentLevel);
}

function triggerGameOver() {
    gameActive = false;
    document.getElementById('final-lvl').innerText = currentLevel;
    document.getElementById('game-over-screen').style.display = 'flex';
    document.getElementById('ui').style.display = 'none';
}

function buildLevel(lvl) {
    const themeKeys = Object.keys(THEMES);
    const index = Math.min(Math.floor((lvl-1)/5), themeKeys.length - 1);
    currentTheme = THEMES[themeKeys[index]];
    
    document.body.style.background = currentTheme.bg;
    document.getElementById('lvl-display').innerText = lvl;
    
    player.x = 100; player.y = 300; player.vx = 0; player.vy = 0;
    cameraX = 0; trail = [];
    platforms = [{ x: 0, y: 500, w: 400, h: 100 }];
    saws = [];
    const len = 2000 + (lvl * 500); goal.x = len;

    for (let i = 1; i < len/400; i++) {
        platforms.push({ x: i * 450, y: 200 + Math.random()*300, w: 200, h: 30 });
        saws.push({ x: i * 450 + 200, y: 100 + Math.random()*350, radius: 25 });
    }
}

window.onmousedown = (e) => {
    if(!gameActive) return;
    player.grapplePoint = { x: e.clientX + cameraX, y: e.clientY };
    const dx = (player.x + 15) - player.grapplePoint.x, dy = (player.y + 15) - player.grapplePoint.y;
    player.length = Math.sqrt(dx*dx + dy*dy); player.isGrappling = true;
};
window.onmouseup = () => player.isGrappling = false;

function update() {
    if(!gameActive) return;
    player.vy += player.gravity; player.vx *= player.drag;
    if (player.isGrappling) {
        const dx = (player.x + 15) - player.grapplePoint.x, dy = (player.y + 15) - player.grapplePoint.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist > player.length) {
            const angle = Math.atan2(dy, dx);
            player.x = (player.grapplePoint.x + Math.cos(angle) * player.length) - 15;
            player.y = (player.grapplePoint.y + Math.sin(angle) * player.length) - 15;
            const vDotR = (player.vx * dx + player.vy * dy) / dist;
            player.vx -= vDotR * (dx/dist); player.vy -= vDotR * (dy/dist);
        }
    }
    player.x += player.vx; player.y += player.vy;
    cameraX += (player.x - cameraX - canvas.width/3) * 0.1;
    trail.push({x: player.x, y: player.y}); if(trail.length > 10) trail.shift();

    platforms.forEach(p => { if (player.x < p.x + p.w && player.x + player.w > p.x && player.y < p.y + p.h && player.y + player.h > p.y && player.vy > 0) { player.y = p.y - player.h; player.vy = 0; } });
    saws.forEach(s => { if(Math.sqrt(((player.x+15)-s.x)**2 + ((player.y+15)-s.y)**2) < s.radius+10) triggerGameOver(); });
    
    if (player.x > goal.x) { currentLevel++; buildLevel(currentLevel); }
    if (player.y > canvas.height + 500) triggerGameOver();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if(!gameActive) return;
    ctx.save(); ctx.translate(-cameraX, 0);

    // Goal
    ctx.fillStyle = currentTheme.accent; ctx.fillRect(goal.x, 0, 10, canvas.height);

    // Trails & Player
    trail.forEach((t, i) => { ctx.globalAlpha = i/20; ctx.fillStyle = currentTheme.accent; ctx.fillRect(t.x, t.y, 30, 30); });
    ctx.globalAlpha = 1;
    ctx.fillStyle = currentTheme.accent; ctx.fillRect(player.x, player.y, 30, 30);
    
    // Hazards (Donut world has Pink Donuts, others have Saws)
    saws.forEach(s => {
        ctx.fillStyle = currentTheme.hazard;
        ctx.beginPath(); ctx.arc(s.x, s.y, s.radius, 0, Math.PI*2); ctx.fill();
        if(currentTheme.name === "DONUT WORLD") {
            ctx.fillStyle = currentTheme.bg; ctx.beginPath(); ctx.arc(s.x, s.y, s.radius/3, 0, Math.PI*2); ctx.fill();
        }
    });

    if(player.isGrappling) { ctx.strokeStyle = "#fff"; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(player.x+15, player.y+15); ctx.lineTo(player.grapplePoint.x, player.grapplePoint.y); ctx.stroke(); }
    platforms.forEach(p => { ctx.fillStyle = currentTheme.plat; ctx.fillRect(p.x, p.y, p.w, p.h); });
    ctx.restore();
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
