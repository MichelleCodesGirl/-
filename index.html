<!DOCTYPE html>
<html>
<head>
    <title>Grapple-Bot: Sugar & Sound</title>
    <style>
        body { margin: 0; overflow: hidden; background: #05050a; font-family: 'Courier New', monospace; transition: background 1s; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; color: #fff; pointer-events: none; z-index: 10; }
        .stat { background: rgba(0, 0, 0, 0.7); padding: 10px; border: 1px solid #fff; margin-bottom: 5px; }
        #dashboard {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9); border: 2px solid #fff; padding: 10px;
            display: flex; gap: 8px; border-radius: 10px;
        }
        .skin-btn {
            width: 35px; height: 35px; border: 2px solid #fff; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 8px;
            color: white; opacity: 0.2; pointer-events: none;
        }
        .skin-btn.unlocked { opacity: 1; pointer-events: auto; }
        .skin-btn.active { border: 3px solid #fff; box-shadow: 0 0 15px #fff; }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: #00fff2; z-index: 100;
        }
        button { padding: 20px 40px; font-size: 24px; background: none; border: 2px solid #00fff2; color: #00fff2; cursor: pointer; font-family: inherit; }
    </style>
</head>
<body>

<div id="overlay">
    <h1>GRAPPLE-BOT</h1>
    <p>WORLD: <span id="start-world">NEON CITY</span></p>
    <button onclick="startGame()">INITIALIZE SYSTEM</button>
</div>

<div id="ui">
    <div class="stat">UNIT: <span id="skin-name">CYBER-BLUE</span></div>
    <div class="stat">FAILURES: <span id="deaths">0</span></div>
</div>

<div id="dashboard">
    <div class="skin-btn unlocked active" id="btn-neon" onclick="selectSkin('neon')" style="background: #00fff2;">NEON</div>
    <div class="skin-btn" id="btn-jungle" onclick="selectSkin('jungle')" style="background: #7cfc00;">GRN</div>
    <div class="skin-btn" id="btn-volcano" onclick="selectSkin('volcano')" style="background: #ff4500;">FIRE</div>
    <div class="skin-btn" id="btn-donut" onclick="selectSkin('donut')" style="background: #ff69b4;">DNT</div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let deaths = 0, currentLevel = 1, sawAngle = 0, cameraX = 0, trail = [], gameRunning = false;

const THEMES = {
    neon: { bg: '#05050a', plat: '#111122', hazard: '#ff0055', accent: '#00fff2', name: 'NEON CITY' },
    jungle: { bg: '#0a1a0a', plat: '#2d4a22', hazard: '#ffcc00', accent: '#7cfc00', name: 'JUNGLE' },
    volcano: { bg: '#1a0505', plat: '#4a1111', hazard: '#ff4500', accent: '#ffda00', name: 'VOLCANO' },
    donut: { bg: '#ffc0cb', plat: '#6f4e37', hazard: '#ff1493', accent: '#ffffff', name: 'DONUT WORLD' }
};

let currentTheme = THEMES.neon;
let activeRobotColor = THEMES.neon.accent;

const player = { x: 100, y: 300, w: 30, h: 30, vx: 0, vy: 0, speed: 0.6, drag: 0.98, gravity: 0.45, grapplePoint: null, isGrappling: false, length: 0 };
let platforms = [], saws = [], goal = { x: 3000 };

// --- 8-BIT MUSIC SYNTHESIZER ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playBeat() {
    if(!gameRunning) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'square';
    osc.frequency.setValueAtTime(110 + (currentLevel * 10), audioCtx.currentTime);
    gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + 0.5);
    setTimeout(playBeat, 500);
}

function startGame() {
    document.getElementById('overlay').style.display = 'none';
    gameRunning = true;
    audioCtx.resume();
    playBeat();
    buildLevel(1);
    loop();
}

function selectSkin(t) { activeRobotColor = THEMES[t].accent; document.querySelectorAll('.skin-btn').forEach(b => b.classList.remove('active')); document.getElementById('btn-' + t).classList.add('active'); }

function buildLevel(lvl) {
    if(lvl >= 6) document.getElementById('btn-jungle').classList.add('unlocked');
    if(lvl >= 11) document.getElementById('btn-volcano').classList.add('unlocked');
    if(lvl >= 16) document.getElementById('btn-donut').classList.add('unlocked');

    if (lvl <= 5) currentTheme = THEMES.neon;
    else if (lvl <= 10) currentTheme = THEMES.jungle;
    else if (lvl <= 15) currentTheme = THEMES.volcano;
    else currentTheme = THEMES.donut;

    document.body.style.background = currentTheme.bg;
    player.x = 100; player.y = 300; player.vx = 0; player.vy = 0;
    cameraX = 0; platforms = [{ x: 0, y: 500, w: 400, h: 100 }]; saws = [];
    const levelLength = 2500 + (lvl * 500); goal.x = levelLength;

    for (let i = 1; i < levelLength / 400; i++) {
        platforms.push({ x: i * 450, y: 200 + Math.random() * 300, w: 200, h: 40 });
        saws.push({ x: i * 450 + 200, y: 100 + Math.random() * 300, radius: 25 });
    }
}

window.onmousedown = (e) => {
    if (gameRunning && e.target.tagName === 'CANVAS') {
        player.grapplePoint = { x: e.clientX + cameraX, y: e.clientY };
        const dx = (player.x + 15) - player.grapplePoint.x, dy = (player.y + 15) - player.grapplePoint.y;
        player.length = Math.sqrt(dx*dx + dy*dy); player.isGrappling = true;
    }
};
window.onmouseup = () => player.isGrappling = false;

function update() {
    player.vy += player.gravity; player.vx *= player.drag;
    if (player.isGrappling) {
        const dx = (player.x + 15) - player.grapplePoint.x, dy = (player.y + 15) - player.grapplePoint.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist > player.length) {
            const angle = Math.atan2(dy, dx);
            player.x = (player.grapplePoint.x + Math.cos(angle) * player.length) - 15;
            player.y = (player.grapplePoint.y + Math.sin(angle) * player.length) - 15;
            const vDotR = (player.vx * dx + player.vy * dy) / dist;
            player.vx -= vDotR * (dx / dist); player.vy -= vDotR * (dy / dist);
        }
    }
    player.x += player.vx; player.y += player.vy;
    cameraX += (player.x - cameraX - canvas.width / 3) * 0.1;
    trail.push({x: player.x, y: player.y}); if (trail.length > 10) trail.shift();
    platforms.forEach(p => { if (player.x < p.x + p.w && player.x + player.w > p.x && player.y < p.y + p.h && player.y + player.h > p.y && player.vy > 0) { player.y = p.y - player.h; player.vy = 0; } });
    saws.forEach(s => { const dx = (player.x + 15) - s.x, dy = (player.y + 15) - s.y; if (Math.sqrt(dx*dx + dy*dy) < s.radius + 10) { deaths++; buildLevel(currentLevel); } });
    if (player.x > goal.x) { currentLevel++; buildLevel(currentLevel); }
    if (player.y > canvas.height + 500) { deaths++; buildLevel(currentLevel); }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save(); ctx.translate(-cameraX, 0);
    
    // Draw Sprinkles if in Donut World
    if(currentTheme.name === "DONUT WORLD") {
        for(let i=0; i<50; i++) {
            ctx.fillStyle = i % 2 === 0 ? "yellow" : "cyan";
            ctx.fillRect(i * 100, (i * 30) % canvas.height, 10, 4);
        }
    }

    trail.forEach((t, i) => { ctx.globalAlpha = i / 20; ctx.fillStyle = activeRobotColor; ctx.fillRect(t.x, t.y, 30, 30); });
    ctx.globalAlpha = 1;
    saws.forEach(s => { ctx.fillStyle = currentTheme.hazard; ctx.beginPath(); ctx.arc(s.x, s.y, s.radius, 0, Math.PI*2); ctx.fill(); });
    if (player.isGrappling) { ctx.strokeStyle = activeRobotColor; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(player.x+15, player.y+15); ctx.lineTo(player.grapplePoint.x, player.grapplePoint.y); ctx.stroke(); }
    ctx.fillStyle = activeRobotColor; ctx.fillRect(player.x, player.y, 30, 30);
    platforms.forEach(p => { ctx.fillStyle = currentTheme.plat; ctx.fillRect(p.x, p.y, p.w, p.h); });
    ctx.restore();
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
</script>
</body>
</html>
