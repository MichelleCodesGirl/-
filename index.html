<!DOCTYPE html>
<html>
<head>
    <title>Grapple-Bot: Evolution</title>
    <style>
        body { margin: 0; overflow: hidden; background: #05050a; font-family: 'Courier New', monospace; transition: background 1s; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; color: #fff; pointer-events: none; }
        .stat { background: rgba(255, 255, 255, 0.1); padding: 10px; border: 1px solid #fff; margin-bottom: 5px; backdrop-filter: blur(5px); }
        #level-tag { position: absolute; top: 20px; right: 20px; color: #fff; font-size: 24px; font-weight: bold; text-align: right; }
        #skin-alert { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-size: 30px; font-weight: bold; text-shadow: 0 0 20px #00fff2;
            display: none; pointer-events: none;
        }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat">UNIT: <span id="skin-name">CYBER-BLUE</span></div>
    <div class="stat">FAILURES: <span id="deaths">0</span></div>
</div>
<div id="level-tag">
    <div id="world-name" style="font-size: 14px;">NEON CITY</div>
    SECTOR: <span id="lvl">1</span>
</div>
<div id="skin-alert">NEW SKIN UNLOCKED!</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let deaths = 0;
let currentLevel = 1;
let sawAngle = 0;
let cameraX = 0;

// --- World & Skin Themes ---
const THEMES = {
    neon: { bg: '#05050a', plat: '#111122', hazard: '#ff0055', accent: '#00fff2', skin: 'CYBER-BLUE', name: 'NEON CITY' },
    jungle: { bg: '#0a1a0a', plat: '#2d4a22', hazard: '#ffcc00', accent: '#7cfc00', skin: 'FOREST-GREEN', name: 'OVERGROWN JUNGLE' },
    volcano: { bg: '#1a0505', plat: '#4a1111', hazard: '#ff4500', accent: '#ffda00', skin: 'MAGMA-RED', name: 'VOLCANIC CORE' }
};
let currentTheme = THEMES.neon;

const player = {
    x: 100, y: 300, w: 30, h: 30,
    vx: 0, vy: 0, speed: 0.6, drag: 0.98, gravity: 0.45,
    grapplePoint: null, isGrappling: false, length: 0
};

let platforms = [];
let saws = [];
let goal = { x: 3000, y: 0 };

function updateTheme() {
    let oldTheme = currentTheme.skin;
    if (currentLevel <= 5) currentTheme = THEMES.neon;
    else if (currentLevel <= 10) currentTheme = THEMES.jungle;
    else currentTheme = THEMES.volcano;
    
    if (oldTheme !== currentTheme.skin) {
        showSkinAlert();
    }

    document.body.style.background = currentTheme.bg;
    document.getElementById('world-name').innerText = currentTheme.name;
    document.getElementById('skin-name').innerText = currentTheme.skin;
    document.getElementById('skin-name').style.color = currentTheme.accent;
}

function showSkinAlert() {
    const el = document.getElementById('skin-alert');
    el.style.display = 'block';
    el.style.textShadow = `0 0 20px ${currentTheme.accent}`;
    setTimeout(() => { el.style.display = 'none'; }, 2000);
}

function buildLevel(lvl) {
    updateTheme();
    player.x = 100; player.y = 300; player.vx = 0; player.vy = 0;
    cameraX = 0;
    platforms = [{ x: 0, y: 500, w: 400, h: 100 }];
    saws = [];
    
    const levelLength = 2500 + (lvl * 600);
    goal.x = levelLength;

    for (let i = 1; i < levelLength / 450; i++) {
        platforms.push({
            x: i * 500 + (Math.random() * 100),
            y: 200 + Math.random() * 350,
            w: 180 + Math.random() * 200,
            h: 30
        });
        
        let sawCount = Math.floor(lvl / 2) + 1;
        for (let j = 0; j < sawCount; j++) {
            saws.push({
                x: i * 500 + (Math.random() * 400),
                y: 100 + (Math.random() * 450),
                radius: 20 + (Math.random() * 25),
            });
        }
    }
}

const keys = {};
window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

window.onmousedown = (e) => {
    player.grapplePoint = { x: e.clientX + cameraX, y: e.clientY };
    const dx = (player.x + 15) - player.grapplePoint.x;
    const dy = (player.y + 15) - player.grapplePoint.y;
    player.length = Math.sqrt(dx*dx + dy*dy);
    player.isGrappling = true;
};
window.onmouseup = () => player.isGrappling = false;

function reset() {
    player.x = 100; player.y = 300;
    player.vx = 0; player.vy = 0;
    player.isGrappling = false;
    deaths++;
    document.getElementById('deaths').innerText = deaths;
}

function update() {
    if (keys['ArrowRight'] || keys['KeyD']) player.vx += player.speed;
    if (keys['ArrowLeft'] || keys['KeyA']) player.vx -= player.speed;
    player.vy += player.gravity;
    player.vx *= player.drag;

    if (player.isGrappling) {
        const dx = (player.x + 15) - player.grapplePoint.x;
        const dy = (player.y + 15) - player.grapplePoint.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist > player.length) {
            const angle = Math.atan2(dy, dx);
            player.x = (player.grapplePoint.x + Math.cos(angle) * player.length) - 15;
            player.y = (player.grapplePoint.y + Math.sin(angle) * player.length) - 15;
            const vDotR = (player.vx * dx + player.vy * dy) / dist;
            player.vx -= vDotR * (dx / dist);
            player.vy -= vDotR * (dy / dist);
        }
    }

    player.x += player.vx; player.y += player.vy;
    sawAngle += 0.15;
    cameraX += (player.x - cameraX - canvas.width / 3) * 0.1;

    platforms.forEach(p => {
        if (player.x < p.x + p.w && player.x + player.w > p.x &&
            player.y < p.y + p.h && player.y + player.h > p.y) {
            if (player.vy > 0) { player.y = p.y - player.h; player.vy = 0; }
        }
    });

    saws.forEach(s => {
        const dx = (player.x + 15) - s.x;
        const dy = (player.y + 15) - s.y;
        if (Math.sqrt(dx*dx + dy*dy) < s.radius + 10) reset();
    });

    if (player.x > goal.x) {
        currentLevel++;
        document.getElementById('lvl').innerText = currentLevel;
        buildLevel(currentLevel);
    }
    if (player.y > canvas.height + 600) reset();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-cameraX, 0);

    // Draw Goal
    ctx.fillStyle = currentTheme.accent;
    ctx.shadowBlur = 20;
    ctx.shadowColor = currentTheme.accent;
    ctx.fillRect(goal.x, 0, 10, canvas.height);

    // Draw Saws
    saws.forEach(s => {
        ctx.save();
        ctx.translate(s.x, s.y);
        ctx.rotate(sawAngle);
        ctx.fillStyle = currentTheme.hazard;
        ctx.shadowColor = currentTheme.hazard;
        ctx.shadowBlur = 15;
        for(let i=0; i<6; i++) {
            ctx.rotate(Math.PI/3);
            ctx.fillRect(0, -s.radius, 4, s.radius*2);
        }
        ctx.restore();
    });

    // Draw Rope
    if (player.isGrappling) {
        ctx.strokeStyle = currentTheme.accent;
        ctx.shadowBlur = 8;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(player.x + 15, player.y + 15);
        ctx.lineTo(player.grapplePoint.x, player.grapplePoint.y);
        ctx.stroke();
    }

    // Draw Player (Robot with Skin)
    ctx.fillStyle = currentTheme.accent;
    ctx.shadowBlur = 15;
    ctx.fillRect(player.x, player.y, player.w, player.h); // Main Body
    ctx.fillStyle = 'rgba(255,255,255,0.8)';
    ctx.fillRect(player.x + 5, player.y + 5, 20, 10); // Visor/Face

    // Draw Platforms
    ctx.shadowBlur = 0;
    ctx.fillStyle = currentTheme.plat;
    platforms.forEach(p => {
        ctx.fillRect(p.x, p.y, p.w, p.h);
        ctx.fillStyle = currentTheme.accent;
        ctx.fillRect(p.x, p.y, p.w, 3);
        ctx.fillStyle = currentTheme.plat;
    });

    ctx.restore();
}

buildLevel(1);
function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
